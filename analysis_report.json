[
  {
    "id": "QUAL-001",
    "location": "packages/utils/src/executor/commandExecutor.ts",
    "severity": "HIGH",
    "evidence_level": "E3",
    "description": "关键工具类 commandExecutor 缺少单元测试",
    "evidence": "该文件包含复杂的 Shell 命令执行和参数转义逻辑，但在 packages/utils/src/executor/ 目录下未发现对应的 __tests__ 或 .test.ts 文件。find 命令确认 utils 包仅有 5 个测试文件。",
    "suggestion": "为 executeCommand, escapeShellArg 等核心函数添加全面的单元测试，特别是针对 Shell 注入防护和重试机制的测试。"
  },
  {
    "id": "QUAL-002",
    "location": "apps/cli/src/cli/commands/analyzeCommand.ts:40",
    "severity": "MEDIUM",
    "evidence_level": "E3",
    "description": "AnalyzeCommand 违反统一输出规范，直接使用 console.log",
    "evidence": "项目已定义 `cliOutput` (apps/cli/src/cli/utils/cliOutput.ts) 用于统一管理 CLI 输出，但 AnalyzeCommand 中多处直接调用 `console.log` 和 `console.error` (如第 44, 53, 54 行)。",
    "suggestion": "将所有 console 调用替换为 `cliOutput.print`, `cliOutput.error` 等方法，以确保输出风格一致并支持测试时的输出捕获。"
  },
  {
    "id": "QUAL-003",
    "location": "apps/cli/src/cli/commands/analyzeCommand.ts:62",
    "severity": "MEDIUM",
    "evidence_level": "E3",
    "description": "AnalyzeCommand 存在强耦合，直接实例化服务类",
    "evidence": "execute 方法中直接执行 `new NpmRegistryService()` 和 `new AIAnalysisService(...)`，而不是通过构造函数注入。这导致难以mock这些依赖进行单元测试。",
    "suggestion": "通过构造函数注入 `INpmRegistryService` 和 `IAIAnalysisService` 接口，或使用依赖注入容器（如果有）来获取实例。"
  },
  {
    "id": "QUAL-004",
    "location": "packages/utils/src",
    "severity": "HIGH",
    "evidence_level": "E3",
    "description": "核心工具包 packages/utils 测试覆盖率极低",
    "evidence": "packages/utils 包含 34 个 TypeScript 源文件，但仅有 5 个测试文件 (~15% 文件覆盖率)。config, logger, executor 等关键模块均缺乏测试。",
    "suggestion": "优先为 configLoader, logger 和 executor 模块补充测试用例，建立基础的测试防护网。"
  },
  {
    "id": "QUAL-005",
    "location": "apps/cli/src/cli/commands/analyzeCommand.ts",
    "severity": "LOW",
    "evidence_level": "E3",
    "description": "未复用公共命令初始化逻辑",
    "evidence": "apps/cli/src/cli/utils/commandHelpers.ts 提供了 `initializeCommand` 用于统一处理配置加载、主题初始化和 Formatter 创建。AnalyzeCommand 手动实现了这些逻辑 (第 39 行)，造成代码重复和行为不一致。",
    "suggestion": "重构 AnalyzeCommand 的 execute 方法，使用 `initializeCommand` 助手函数来替代手动的初始化代码。"
  }
]
