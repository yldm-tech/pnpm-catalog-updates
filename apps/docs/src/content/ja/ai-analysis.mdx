export const metadata = {
  title: 'AI分析',
  description:
    'AI駆動の分析を使用して、依存関係の更新に関するインテリジェントな推奨事項、セキュリティ評価、破壊的変更の検出を取得します。',
};

# AI分析

PCUはAI CLIツールと統合して、インテリジェントな依存関係分析、セキュリティ評価、更新推奨を提供します。 {{ className: 'lead' }}

## 概要

AI分析はPCUの機能を次のように強化します：

- **影響分析**：更新がコードベースにどのように影響するかを理解
- **セキュリティ評価**：AI駆動のセキュリティ脆弱性分析を取得
- **互換性チェック**：潜在的な破壊的変更を検出
- **更新推奨**：安全な更新のためのインテリジェントな提案を受信

## サポートされるAIプロバイダー

PCUは利用可能なAI CLIツールを自動的に検出し、以下の優先順位で使用します：

| プロバイダー | 優先度 | 機能                             |
| ------------ | ------ | -------------------------------- |
| Gemini       | 100    | 影響、セキュリティ、互換性、推奨 |
| Claude       | 80     | 影響、セキュリティ、互換性、推奨 |
| Codex        | 60     | 影響、互換性、推奨               |
| Cursor       | 40     | 影響、推奨                       |

<Note>
  AIプロバイダーが利用できない場合、PCUは自動的にルールベースの分析エンジンにフォールバックし、事前定義されたルールを使用して基本的な依存関係分析を提供します。
</Note>

---

## コマンド

### 利用可能なAIプロバイダーの確認

システム上で利用可能なAIツールを表示：

```bash
pcu ai
```

このコマンドは以下を表示します：

- システムで検出された利用可能なAI CLIツール
- 各プロバイダーのバージョン情報
- 分析に使用される最適なプロバイダー

### AI駆動の更新

AI駆動の分析で依存関係を更新：

<CodeGroup>

```bash {{ title: '基本AI更新' }}
pcu update --ai
pcu u --ai
```

```bash {{ title: 'インタラクティブAI更新' }}
pcu update --ai --interactive
pcu u --ai -i
```

</CodeGroup>

AI拡張更新は以下を提供：

- 各更新のインテリジェントなリスク評価
- 説明付きの破壊的変更検出
- セキュリティ脆弱性の識別
- 推奨される更新順序

### AI駆動の分析

AIアシスタンスで特定のパッケージ更新を分析：

<CodeGroup>

```bash {{ title: 'パッケージの分析' }}
pcu analyze react
pcu a lodash
```

```bash {{ title: '特定バージョンの分析' }}
pcu analyze react 19.0.0
pcu a typescript 5.5.0
```

</CodeGroup>

<Note>
  `analyze`コマンドはデフォルトで`default`カタログを使用します。最初の引数として異なるカタログを指定できます：`pcu
  analyze my-catalog react`
</Note>

---

## 分析タイプ

### 影響分析

依存関係の更新がプロジェクトにどのように影響するかを評価：

- その依存関係を使用するすべてのワークスペースパッケージを識別
- バージョン間のAPI変更を分析
- 必要な移行作業を見積もり
- テストの重点領域を提案

### セキュリティ分析

セキュリティに焦点を当てた評価を提供：

- 現在のバージョンの既知の脆弱性を識別
- 新バージョンのセキュリティ修正をチェック
- セキュリティに関連するパッケージ更新を評価
- セキュリティのベストプラクティスを推奨

### 互換性分析

潜在的な互換性の問題をチェック：

- 破壊的なAPI変更を検出
- ピア依存関係の競合を識別
- Node.jsバージョンの互換性をチェック
- TypeScriptの互換性を検証

### 推奨事項

実行可能な推奨事項を生成：

- 最適な更新順序を提案
- バージョン範囲を推奨
- 一緒に更新すべきパッケージを識別
- ロールバック戦略を提供

---

## フォールバック動作

AIプロバイダーが利用できない場合、PCUは組み込みのルールベース分析エンジンを使用します：

### ルールベース分析機能

- **バージョンジャンプ評価**：セマンティックバージョニングの変更に基づいてリスクを評価
- **既知の破壊パターン**：人気パッケージ（React、TypeScript、ESLintなど）の破壊的変更を検出
- **セキュリティ敏感パッケージ**：セキュリティ関連のパッケージにフラグを立てて慎重にレビュー
- **作業量見積もり**：移行作業量の見積もりを提供

### リスクレベル

| レベル | 説明                                                         |
| ------ | ------------------------------------------------------------ |
| 低     | パッチ更新、通常は安全に適用可能                             |
| 中     | マイナー更新または大きなマイナーバージョンジャンプ           |
| 高     | 破壊的変更を伴うメジャーバージョン更新                       |
| 重大   | 複数のメジャーバージョンジャンプまたはプレリリースバージョン |

---

## 設定

### 環境変数

<Properties>
  <Property name="GEMINI_PATH" type="string">
    Gemini CLI実行ファイルへのカスタムパス
  </Property>
  <Property name="CLAUDE_PATH" type="string">
    Claude CLI実行ファイルへのカスタムパス
  </Property>
  <Property name="CODEX_PATH" type="string">
    Codex CLI実行ファイルへのカスタムパス
  </Property>
  <Property name="CURSOR_PATH" type="string">
    Cursor CLI実行ファイルへのカスタムパス
  </Property>
</Properties>

### 検出方法

PCUはAIプロバイダーを検出するために複数の戦略を使用します：

1. **環境変数**：カスタムパス変数をチェック
2. **PATH検索**：`which`コマンドを使用して実行ファイルを検索
3. **既知のパス**：一般的なインストール場所をチェック
4. **アプリケーションパス**：GUIアプリケーション（例：Cursor.app）をチェック

---

## 使用例

### 安全な更新ワークフロー

```bash
# AI分析で更新をチェック
pcu check

# 特定の高リスク更新を分析
pcu analyze react 19.0.0
pcu analyze typescript 5.5.0

# AIガイド付きインタラクティブ更新を実行
pcu update --ai --interactive --create-backup
```

### CI/CD統合

```bash
# CIでAI分析をJSON出力で実行
pcu update --ai --dry-run --format json > ai-analysis.json

# 高リスク更新をチェック
pcu analyze default typescript --format json | jq '.riskLevel'
```

### バッチ分析

```bash
# AI推奨ですべてのパッケージを更新
pcu update --ai --target minor

# AI分析でメジャー更新をレビュー
pcu update --ai --target latest --confirm-major
```

---

## ベストプラクティス

### AI分析を使用するタイミング

- **メジャーバージョン更新**：メジャーバージョンアップには常にAI分析を使用
- **セキュリティ敏感パッケージ**：認証、暗号化、セッションパッケージに使用
- **大規模コードベース**：AIがモノレポ全体の影響領域を識別するのに役立つ
- **破壊的変更検出**：AIが詳細な破壊的変更の説明を提供

### パフォーマンスの考慮事項

- AI分析は標準更新と比較して処理時間が追加される
- `--dry-run`を使用して変更を適用せずにAI推奨をプレビュー
- AIが重要でない場合、より高速なCI/CDパイプラインにはルールベースのフォールバックを検討

### 他の機能との組み合わせ

```bash
# AI分析とセキュリティスキャン
pcu update --ai && pcu security

# AI分析とバックアップ
pcu update --ai --create-backup

# AI分析と特定ターゲット
pcu update --ai --target minor --exclude "*-dev"
```
