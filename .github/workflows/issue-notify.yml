name: Issue Telegram Notify

on:
  issues:
    types: [opened, reopened, closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    environment: public
    steps:
      - name: Send Telegram Notification
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          TELEGRAM_THREAD_ID: ${{ secrets.TELEGRAM_PCU_THREAD_ID }}
        run: |
          ACTION="${{ github.event.action }}"
          case "$ACTION" in
            opened)   EMOJI="üÜï"; STATUS="New Issue" ;;
            reopened) EMOJI="üîÑ"; STATUS="Reopened" ;;
            closed)   EMOJI="‚úÖ"; STATUS="Closed" ;;
          esac

          MESSAGE="${EMOJI} *${STATUS}* \#${{ github.event.issue.number }}

          üìù *${{ github.event.issue.title }}*
          üë§ By: [${{ github.event.issue.user.login }}](${{ github.event.issue.user.html_url }})

          üîó [View Issue](${{ github.event.issue.html_url }})"

          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d message_thread_id="${TELEGRAM_THREAD_ID}" \
            -d parse_mode="Markdown" \
            -d text="${MESSAGE}"
